<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Mazda Mods III: Prototyping">
	
	<link rel="icon" type="image/x-icon" href="/favicon.ico" sizes="48x48"/>
	<link rel="shortcut icon" href="/favicon.ico"/>
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
	<link rel="manifest" href="/site.webmanifest"/>

	<title>Mazda Mods III: Prototyping</title>
	<!-- Bootstrap -->
	<link href="/css/bootstrap-4.4.1.css" rel="stylesheet">
	
	<style>
		figure > img {
			height: 280px;
			border: 3px solid #888;
		}

		figure {
			align-content: center;
			text-align: center;
			font-size: 1em;
			font-style: italic;
			color: #666;
		}
	</style>
</head>

<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
		<a class="navbar-brand" href="/index.html">tobo.games</a>
      	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      	<span class="navbar-toggler-icon"></span>
      	</button>
      	<div class="collapse navbar-collapse" id="navbarSupportedContent">
        	<ul class="navbar-nav mr-auto">
				<li class="nav-item">
            		<a class="nav-link" href="/Blog/index.html">Blog</a>
          		</li>
				<li class="nav-item">
            		<a class="nav-link" href="/portfolio.html">Portfolio</a>
          		</li>
          		<li class="nav-item dropdown">
            		<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            		Projects
            		</a>
            		<div class="dropdown-menu" aria-labelledby="navbarDropdown">
					  	<a class="dropdown-item" href="/Projects/index.html">Project Home Page</a>
						<div class="dropdown-divider"></div>
						<a class="dropdown-item" href="/Projects/DesignWeek/index.html">Design Week</a>
					  	<a class="dropdown-item" href="/Projects/Personal/index.html">Teenage Experiments</a>
					  	<a class="dropdown-item" href="/Projects/School/index.html">School Projects</a>
					  	<div class="dropdown-divider"></div>
					  	<a class="dropdown-item" href="/Projects/Modelling/index.html">3D Modelling</a>
            		</div>
          		</li>
				<li class="nav-item">
            		<a class="nav-link" href="/VVGamesLauncher.exe" role="button" download>Download Launcher</a>
          		</li>
				<li class="nav-item">
					<a class="nav-link" href="https://github.com/tobogganeer" target="_blank" rel="noopener" aria-label="GitHub">
						<img src="/images/github-mark-white.svg" width="20" height="20" alt="Github logo">
					</a>
          		</li>
        	</ul>
      	</div>
    </nav>
    <section>
      	<div class="jumbotron text-center mt-2 p-4">
        	<div class="container">
          		<div class="row justify-content-center">
            		<div class="col-12">
              			<h1 style="text-decoration: underline; font-size: 4em">Mazda Mods III: Prototyping</h1>
						<p>May 30, 2025</p>
						<a href="/Blog/index.html"><button class="btn btn-primary btn-lg" type="button">Back to Blogs Â»</button></a>
            		</div>
          		</div>
			</div>
      	</div>
    </section>
    <section>
      	<div class="container">
        	<h2>Intro</h2>
			<p>I've been working on the car where I can, but work is picking up for the summer. It's nice to know I'll always have hobbies whehn I get older :)</p>
			<p>I've been doing lots of "CAD", 3D printing, and hardware prototyping. A couple more iterations on my fuse box design and some more CAN sniffing and I can start installing things!</p>
			
			<hr>
			<h2>Control Panel</h2>
			<p>I'm going to be adding lots of knickknacks, displays, gadgets, etc. I need some way to control them (mainly turn them on and off). After scouting out areas around the driver, I've decided on a side panel where higher-trim models put controls:</p>
			
			<figure>
				<img src="Images/controllocation.jpg" style="height: 300px;" alt="Car trim panel with a rectangular hole in it">
				<figcaption>I've taken off the ABS top panel here. I have a nice big hole to work with.</figcaption>
			</figure>
			
			<p>I want a bunch of switches, some buttons, and a display to put info about the car (fuel economy, coolant temp, service intervals, etc. I did some measuring and got to modelling in my favourite CAD software: Blender.</p>
			
			<figure>
				<img src="Images/controlsv1.png" style="height: 300px;" alt="3D model of a bunch of switches and buttons">
				<img src="Images/controlsv1print.jpg" style="height: 300px;" alt="3D print of the model with switches and a button in place">
				<figcaption>Sizing out how many buttons, switches, etc. can fit on the panel. Can you spot my mistake?</figcaption>
			</figure>
			
			<p>One error I made with the first iteration was making it the size of the <em>entire</em> top panel I pulled off - I don't actually have that much room!</p>

			<figure>
				<img src="Images/controlsizeerror.png" style="height: 300px;" alt="Labelled diagram of the entire panel vs the small section I can work with">
				<figcaption>Unless I want to start cutting the OEM trim, I need to fit in the green area.</figcaption>
			</figure>
			
			<p>With that, I started on V2:</p>
			
			<figure>
				<img src="Images/controlsv2cad.png" style="height: 300px;" alt="3D model of a bunch of switches and buttons">
				<img src="Images/controlsv2pla.jpg" style="height: 300px;" alt="3D print of the model with switches and a button in place">
				<img src="Images/controlsv2petg.jpg" style="height: 300px;" alt="3D print of the model with switches and a button in place">
				<figcaption>V2 is smaller, and also angles the display for easier viewing. Test print in PLA, final print in PETG for temperature resistance.</figcaption>
			</figure>
			
			<p>The switches will toggle components on and off, the large button is for a horn, the small buttons are extra, and the dial/rotary encoder is for controlling the info display.</p>
			
			<p>I still need to decide how to mount this to the trim - should I replace the top ABS piece, cut into it, etc.? I'm not sure yet.</p>
			
			<hr>
			
			<h2>Fuse Box(es)</h2>
			<p>All the new stuff I'm adding needs power. To make it easy and safe to deliver, I'm going to add two new fuseboxes: a small one fed directly from the battery, and a larger one running on switches power (only on when the car's on).</p>
			<p>I'm no electrical engineer and not great when it comes to electricity. I want to make sure I don't light the car on fire, so here's my plan for keeping things safe:</p>
			
			<ul>
				<li>All systems I'm adding shouldn't draw more than ~25A, so I'll use 8 AWG wire from the battery to the fuse box</li>
				<li>Put a 40A fuse right next to the battery just in case things go terribly wrong</li>
				<li>Put a breaker inside the car so I can cut power to the battery-fed box (moreso for leaving the car off for long periods of time)</li>
				<li>Relay between the battery and accessory box, activated by a tap into the cigarette lighter fuse</li>
				<li>Fuses for each individual circuit</li>
				<li>Most circuits will run on 5V using switch-mode buck convertors</li>
			</ul>
			
			<p>From there it's just running wires from the components back to the fuse box, using wire loom and tape where necessary.</p>
			
			<p>I'm currently working on prototyping the fuse box mounting, but here's where I'm at so far:</p>
			
			<div class="row">
				<div class="col col-md-4">
					<figure>
						<img src="Images/fuseboxsizing.jpg" style="height: 300px;" alt="Fuse box loosely placed in car frame">
						<figcaption>This seems like a good place to put the boxes</figcaption>
					</figure>
				</div>
				<div class="col col-md-4">
					<figure>
						<img src="Images/fuseboxv1cad.png" style="height: 300px;" alt="Blender model of fuse box mounting">
						<figcaption>Version 1 in Blender</figcaption>
					</figure>
				</div>
				<div class="col col-md-4">
					<figure>
						<img src="Images/fuseboxv1.jpg" style="height: 300px;" alt="3D printed mounting with fuse boxes attached">
						<figcaption>Rough print of V1 with boxes and relay mounted</figcaption>
					</figure>
				</div>
			</div>
			<div class="row">
				<div class="col col-md-4">
					<figure>
						<img src="Images/fuseboxv1size.jpg" style="height: 300px;" alt="Printed and mounted box placed in car for sizing">
						<figcaption>Not a great fit, and this isn't even both boxes...</figcaption>
					</figure>
				</div>
				<div class="col col-md-4">
					<figure>
						<img src="Images/fuseboxv2cad.png" style="height: 300px;" alt="Second version of mounting in Blender">
						<figcaption>Version two, mounting on front and back</figcaption>
					</figure>
				</div>
				<div class="col col-md-4">
					<figure>
						<img src="Images/fuseboxv2.jpg" style="height: 300px;" alt="Second version printed out">
						<figcaption>Relay and battery fuse box are mounted on the backside</figcaption>
					</figure>
				</div>
			</div>
			
			<hr>
			
			<p>I haven't sized this one up in the car yet, so that's about where the power situation lies for now. If the fit is good, I'll add a way to attach the mounting bracket to that metal rail and print it in PETG. Then there's some wiring to the battery and a fuse tap, and then I'm good to start adding things (exciting!).</p>
			
			<hr>
			
			<h2 id="audioswitcher">Audio Switcher</h2>
			<p>I'm going to have a million (5) different audio sources I need to get into the car (aux, USB, Lightning, Bluetooth, carputer). I'm going to hijack the car's aux port, selecting which input I want to feed in through a little control knob. So... how am I gonna do this?</p>
			
			<p>Starting out, my idea was to make a switchboard with a million aux cables that you manually plug into one port.<br>
				Pros: Cool n fun<br>
				Cons: You need to take your eyes off the road and hands off the wheel<br>
			So I looked into digital (or should I say analog) options.</p>
			
			<p>Relays seemed like a good first step, and in the <a href="https://forum.arduino.cc/t/using-an-arduino-uno-as-an-audio-switch/679015/3" target="_blank">comments of a forum post</a> I learned about the existence of solid-state analog relays (analog multi and de-multiplexers. I looked up datasheets for a bunch of different demultiplexers and settled on the <a href="https://www.ti.com/lit/ds/symlink/cd4051b.pdf" target="_blank">CD4052B</a> from TI. The 4052 specifically has 4 sets of stereo inputs that I'm feeding into one output. I have two of these chips, with one hooked into the other. This means I have 7 total inputs (giving me two extra if I ever add any more audio tomfoolery).</p>
			
			<p>That's a lot of text, here are some pretty pictures:</p>
			<div class="row">
				<div class="col col-md-6">
					<figure>
						<img src="Images/audioswitcher.jpg" style="height: 300px;" alt="A bunch of wires and chips">
						<figcaption>Display, rotary encoder, ESP8266, two CD4052B's, and some aux ports for testing</figcaption>
					</figure>
				</div>
				<div class="col col-md-6">
					<figure>
						<video controls height="250">
							<source src="Images/audioworking.mp4" type="video/mp4"/>
						</video>
						<figcaption>Hard to hear, but when I switch to Aux you can hear audio coming through</figcaption>
					</figure>
				</div>
			</div>
			
			<hr>
			<p>It remains to be seen whether this solution will have noise, or work at all, but it's a good start.</p>
			
			<hr>
			
			<h2>CAN Sniffing</h2>
			<p>I found two great sources for the <a href="https://docs.google.com/spreadsheets/d/1SKfXAyo6fbAfMUENw1KR3w4Fvx_Ihj6sTPSVXBdOXKk/edit?gid=0#gid=0" target="_blank">HS</a> and <a href="https://docs.google.com/spreadsheets/d/1wjpo5WGLxsswjUi0MUDwKySKp3XejPfE5vdeieBFiGY/edit?gid=0#gid=0" target="_blank">MS</a> CAN buses online.
			They have some decoded CAN packets and were a great place to start, though not entirely accurate to my car (e.g. the MS CAN bus runs at 125kbps rather than 250, some CAN IDs don't match up, etc.</p>
			
			<p>All I really have to say about it is that I'm working on parsing in the data so I can send it out to all other modules:</p>
			
			<figure>
				<img src="Images/extractingdata.jpg" style="height: 300px;" alt="Data printed from the car (speed, RPM, etc)">
				<img src="Images/extractingrpm.png" style="height: 300px;" alt="Excel sheet graphing RPM over time">
				<figcaption>I made a little Python script to export the serial data as a CSV file so I can analyze it in Excel</figcaption>
			</figure>
			
			<p>I have a couple things I want to see if I can find like oil pressure, what doors are opened, and if the clutch is pressed.</p>
			
			<hr>
			<h2>Summary</h2>
			<p>I've been doing a lot of 3D printing! My poor print bed looks like a minefield - about 15% of it is unusable by now (maybe I can replace it with painter's tape?). There's still more to do - figure out a working fuse box mount, panel for the audio switcher display and controls, panel for a gear indicator display, USB port panels, etc. But I'm making stuff, learning, having fun and getting there!</p>
			<p>Even if all I accomplish is Bluetooth audio and a way to see my fuel economy I'll be happy. I just like tinkering :)</p>
      	</div>
    </section>
    <hr>
    <footer class="text-center">
      	<div class="container">
        	<div class="row">
          		<div class="col-12">
            		<p class="mb-0">Evan Daveikis 2025</p>
			  		<small class="mt-0 pb-3 text-muted">Very clearly not a web designer but I'm trying to learn!</small>
          		</div>
        	</div>
      	</div>
    </footer>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="/js/jquery-3.4.1.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap-4.4.1.js"></script>
</body>
</html>